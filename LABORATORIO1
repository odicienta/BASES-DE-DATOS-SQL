-- Drop Tables
DROP TABLE CLIENTE CASCADE CONSTRAINTS;
DROP TABLE GENERO CASCADE CONSTRAINTS;
DROP TABLE PELICULA CASCADE CONSTRAINTS;
DROP TABLE PRESTAMO CASCADE CONSTRAINTS;
DROP TABLE DETALLE_PRESTAMO CASCADE CONSTRAINTS;
-- CREATE TABLE

CREATE TABLE CLIENTE
(
IDCLIENTE           NUMBER(9) CONSTRAINT pk_CLIENTE PRIMARY KEY CHECK (IDCLIENTE >=0),
NOMBRE              VARCHAR2(15) NOT NULL,
APELLIDO            VARCHAR2(15) NOT NULL,
DIRECCION           VARCHAR2(60) NOT NULL,
TELEFONO            NUMBER(8) NOT NULL UNIQUE CONSTRAINT CK_TELEFONO CHECK (TELEFONO >=0)
);

CREATE TABLE GENERO
(
GENERO              NUMBER(9) CONSTRAINT pk_GENERO PRIMARY KEY CHECK (GENERO >=0),
DESCRIPCION         VARCHAR2(15) NOT NULL UNIQUE
);

CREATE TABLE PELICULA
(
PELICULA            NUMBER(9) CONSTRAINT pk_PELICULA PRIMARY KEY CHECK (PELICULA >=0),
NOMBRE              VARCHAR2(15) NOT NULL,
AÑO                 NUMBER(4) NOT NULL CONSTRAINT ck_AÑO CHECK (AÑO>=1950),
GENERO              NUMBER(9) NOT NULL CONSTRAINT fk_GENERO REFERENCES GENERO(GENERO),
FECHA_INGRESO       DATE DEFAULT SYSDATE NOT NULL,
ESTRENO             CHAR(1)NOT NULL CONSTRAINT ck_ESTRENO CHECK(ESTRENO IN ('S','s','N','n')),
EXISTENCIA          NUMBER(2) NOT NULL CONSTRAINT ck_EXIS CHECK (EXISTENCIA>=0)
);

CREATE TABLE PRESTAMO
(
PRESTAMO            NUMBER(10)CONSTRAINT pk_PRESTAMO PRIMARY KEY CHECK (PRESTAMO >=0),
CLIENTE             NUMBER(9)NOT NULL CONSTRAINT fk_CLIENTE REFERENCES CLIENTE(IDCLIENTE),
FECHA_PRESTAMO      DATE DEFAULT SYSDATE,
FECHA_DEVOLUCION    DATE DEFAULT SYSDATE,
FECHA_REALDEVOLUCION DATE DEFAULT SYSDATE,
PELICULAS           NUMBER(2) CONSTRAINT ck_PELICULAS CHECK(PELICULAS >=0),
TOTAL               NUMBER(5) AS (PELICULAS * 1000)CONSTRAINT ck_TOTAL CHECK(TOTAL>=0),
MULTA               NUMBER(5)AS ((FECHA_REALDEVOLUCION - FECHA_DEVOLUCION)*500)CONSTRAINT ck_MULTA CHECK(MULTA>=0)
);

CREATE TABLE DETALLE_PRESTAMO
(
PRESTAMO            NUMBER(10) NOT NULL CONSTRAINT fk_PRESTAMO REFERENCES PRESTAMO(PRESTAMO),
PELICULA            NUMBER(9) NOT NULL CONSTRAINT fk_PELICULA REFERENCES PELICULA(PELICULA)
);
--INSERT
--CLIENTE
INSERT INTO CLIENTE VALUES (1,'JUAN','GOMEZ','TIBAS',62859811);
INSERT INTO CLIENTE VALUES (2,'SUSANA','SALAZAR','PAVAS',45123698);
--GENERO
INSERT INTO GENERO VALUES (3,'TERROR');
INSERT INTO GENERO VALUES (4,'ACCION');
--PELICULA
INSERT INTO PELICULA(PELICULA,NOMBRE,AÑO,GENERO,FECHA_INGRESO,ESTRENO,EXISTENCIA)
                VALUES (87654210,'AVENGERS',2015,4,SYSDATE,'S',20);
INSERT INTO PELICULA(PELICULA,NOMBRE,AÑO,GENERO,FECHA_INGRESO,ESTRENO,EXISTENCIA)
                VALUES (98756234,'IT',2020,3,SYSDATE,'N',2);
--PRESTAMO
INSERT INTO PRESTAMO(PRESTAMO,CLIENTE,FECHA_PRESTAMO,FECHA_DEVOLUCION,FECHA_REALDEVOLUCION,PELICULAS)
                VALUES(5,1,SYSDATE,SYSDATE,SYSDATE,2);
INSERT INTO PRESTAMO(PRESTAMO,CLIENTE,FECHA_PRESTAMO,FECHA_DEVOLUCION,FECHA_REALDEVOLUCION,PELICULAS)
                VALUES(6,2,SYSDATE,SYSDATE,SYSDATE,1);
--DETALLE_PRESTAMO
INSERT INTO DETALLE_PRESTAMO(PRESTAMO,PELICULA)
VALUES(5,87654210);
INSERT INTO DETALLE_PRESTAMO(PRESTAMO,PELICULA)
VALUES(6,98756234);
COMMIT;

-- SELECT
SELECT * FROM CLIENTE
SELECT * FROM GENERO
SELECT * FROM PELICULA
SELECT * FROM PRESTAMO
SELECT * FROM DETALLE_PRESTAMO

